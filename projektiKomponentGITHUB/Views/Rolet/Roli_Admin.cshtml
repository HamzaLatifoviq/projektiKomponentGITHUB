@{
    ViewBag.Title = "Roli_Admin";
}

@model List<projektiKomponentGITHUB.Models.UserViewModel>

@{
    var payments = ViewBag.Payments as List<projektiKomponentGITHUB.Models.Payment>;
}

<div class="container mt-5">
    <h2>Paneli i Administratorit</h2>

    <!-- Nav Tabs -->
    <ul class="nav nav-tabs mt-4" id="adminTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">Menaxho Perdoruesit</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="payments-tab" data-bs-toggle="tab" data-bs-target="#payments" type="button" role="tab">Menaxho Pagesat</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="hotels-tab" data-bs-toggle="tab" data-bs-target="#hotels" type="button" role="tab">Menaxho Hotelet</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="cars-tab" data-bs-toggle="tab" data-bs-target="#cars" type="button" role="tab">Menaxho Agjencite e Veturave</button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content p-4 border border-top-0 shadow-sm" id="adminTabsContent">
        <!-- Users Tab -->
        <div class="tab-pane fade show active" id="users" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4>Menaxho Perdoruesit</h4>
                @Html.ActionLink("Shto Perdorues", "CreateUser", "Rolet", null, new { @class = "btn btn-sm btn-success" })
            </div>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Username</th>
                        <th>Emri</th>
                        <th>Mbiemri</th>
                        <th>Email</th>
                        <th>Roli</th>
                        <th>Krijuar me</th>
                        <th>Hyrja e fundit</th>
                        <th>Veprime</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.Count; i++)
                    {
                        <tr>
                            <td>@(i + 1)</td>
                            <td>@Model[i].Username</td>
                            <td>@Model[i].Emri</td>
                            <td>@Model[i].Mbiemri</td>
                            <td>@Model[i].Email</td>
                            <td>@Model[i].Role</td>
                            <td>@Model[i].CreatedAt.ToString("dd/MM/yyyy")</td>
                            <td>@(Model[i].LastLogin?.ToString("dd/MM/yyyy HH:mm") ?? "-")</td>
                            <td>
                                <a href="@Url.Action("EditUser", "Rolet", new { id = Model[i].UserId })" class="btn btn-sm btn-warning">Ndrysho</a>
                                @Html.ActionLink("Fshij", "DeleteUser", "Rolet", new { id = Model[i].UserId }, new { @class = "btn btn-sm btn-danger" })
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Payments Tab -->
        <div class="tab-pane fade" id="payments" role="tabpanel">
            <h4>Menaxho Pagesat</h4>
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Emri</th>
                        <th>Mbiemri</th>
                        <th>Emaili</th>
                        <th>Adresa</th>
                        <th>Numri Telefonit</th>
                        <th>Numri Kartes</th>
                        <th>Data Skadimit</th>
                        <th>Menyra Pageses</th>
                        <th>Shuma</th>
                        <th>Statusi</th>
                        <th>Veprime</th>
                    </tr>
                </thead>
                <tbody>
                    @if (payments != null && payments.Count > 0)
                    {
                        int index = 1;
                        foreach (var payment in payments)
                        {
                            <tr>
                                <td>@index</td>
                                <td>@payment.Emri</td>
                                <td>@payment.Mbiemri</td>
                                <td>@payment.Emaili</td>
                                <td>@payment.Adresa</td>
                                <td>@payment.NumriTelefonit</td>
                                <td>@payment.NumriKartes</td>
                                <td>@payment.DataSkadimit.ToString("MM/yyyy")</td>
                                <td>@payment.MenyraPageses</td>
                                <td>@payment.Shuma.ToString("C")</td>
                                <td>@payment.PaymentStatus</td>
                                <td>
                                    @using (Html.BeginForm("UpdatePaymentStatus", "Rolet", FormMethod.Post, new { @class = "d-inline" }))
                                    {
                                        @Html.AntiForgeryToken()
                                        @Html.Hidden("id", payment.Id)
                                        <div class="d-flex justify-content-center gap-2">
                                            <button type="submit" name="status" value="Pranuar" class="btn btn-sm btn-success flex-fill" @(payment.PaymentStatus == "Pranuar" ? "disabled" : "")>Prano</button>
                                            <button type="submit" name="status" value="Refuzuar" class="btn btn-sm btn-danger flex-fill" @(payment.PaymentStatus == "Refuzuar" ? "disabled" : "")>Refuzo</button>
                                        </div>
                                    }

                                </td>
                            </tr>
                            index++;
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="12" class="text-center">Nuk ka pagesa per tu menaxhuar.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Hotels Tab -->
        <div class="tab-pane fade" id="hotels" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4>Menaxho Hotelet</h4>
                <div class="tab-pane fade show active" id="paymentsHotel" role="tabpanel">
                    <h4>Menaxho Pagesat Per Hotele</h4>
                    <table class="table table-bordered table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>Emri</th>
                                <th>Mbiemri</th>
                                <th>Emaili</th>
                                <th>Adresa</th>
                                <th>Numri Telefonit</th>
                                <th>Numri Kartes</th>
                                <th>Data Skadimit</th>
                                <th>Menyra Pageses</th>
                                <th>Shuma</th>
                                <th>Statusi</th>
                                <th>Veprime</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (ViewBag.HotelPayments != null && ((List<projektiKomponentGITHUB.Models.Payments2Hotel>)ViewBag.HotelPayments).Count > 0)
                            {
                                int index = 1;
                                foreach (var payment in (List<projektiKomponentGITHUB.Models.Payments2Hotel>)ViewBag.HotelPayments)
                                {
                                    <tr>
                                        <td>@index</td>
                                        <td>@payment.Emri</td>
                                        <td>@payment.Mbiemri</td>
                                        <td>@payment.Emaili</td>
                                        <td>@payment.Adresa</td>
                                        <td>@payment.NumriTelefonit</td>
                                        <td>@payment.NumriKartes</td>
                                        <td>@payment.DataSkadimit.ToString("MM/yyyy")</td>
                                        <td>@payment.MenyraPageses</td>
                                        <td>@payment.Shuma.ToString("C")</td>
                                        <td>@payment.PaymentStatus</td>
                                        <td>
                                            @using (Html.BeginForm("UpdateHotelPaymentStatus", "Rolet", FormMethod.Post, new { @class = "d-inline" }))
                                            {
                                                @Html.AntiForgeryToken()
                                                @Html.Hidden("id", payment.Id)
                                                <div class="d-flex justify-content-center gap-2">
                                                    <button type="submit" name="status" value="Pranuar" class="btn btn-sm btn-success flex-fill" @(payment.PaymentStatus == "Pranuar" ? "disabled" : "")>Prano</button>
                                                    <button type="submit" name="status" value="Refuzuar" class="btn btn-sm btn-danger flex-fill" @(payment.PaymentStatus == "Refuzuar" ? "disabled" : "")>Refuzo</button>
                                                </div>
                                            }
                                        </td>
                                    </tr>
                                    index++;
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="12" class="text-center">Nuk ka pagesa per t'u menaxhuar.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

        <!-- Cars Tab -->
        <div class="tab-pane fade" id="cars" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4>Menaxho Agjencite e Veturave</h4>
                <button class="btn btn-sm btn-success">Shto Agjenci</button>
            </div>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Emri i Agjencise</th>
                        <th>Qyteti</th>
                        <th>Kontakti</th>
                        <th>Veprime</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>AutoDrive Rent</td>
                        <td>Tetove</td>
                        <td>Ardit K.</td>
                        <td>
                            <button class="btn btn-sm btn-warning">Ndrysho</button>
                            <button class="btn btn-sm btn-danger">Fshij</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
