@{
    ViewBag.Title = "Hotel1";
}

<h2 class="text-center mb-4" style="color: #2c3e50;">Hotel Stone Bridge</h2>
<div class="container mt-4">
    <div class="row">
        <!-- Carousel për fotografitë -->
        <div class="col-md-8">
            <div id="hotelCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="/Content/BesnikFotoHotel/stonebridge1.jpg" class="d-block w-100 rounded" alt="Pamje nga Hotel Stone Bridge" style="max-height: 400px; object-fit: cover;">
                    </div>
                    <div class="carousel-item">
                        <img src="/Content/BesnikFotoHotel/stonebridge2.jpg" class="d-block w-100 rounded" alt="Pamje e dhomës në Hotel Stone Bridge" style="max-height: 400px; object-fit: cover;">
                    </div>
                    <div class="carousel-item">
                        <img src="/Content/BesnikFotoHotel/stonebridge3.jpg" class="d-block w-100 rounded" alt="Pamje e restorantit në Hotel Stone Bridge" style="max-height: 400px; object-fit: cover;">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#hotelCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#hotelCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <!-- Përshkrimi i Hotelit -->
        <div class="col-md-4">
            <h5 style="color: #34495e;">Përshkrimi i Hotelit</h5>
            <p>
                Stone Bridge Hotel është një hotel luksoz me 5 yje i vendosur në zemër të Shkupit,
                pranë urës historike prej guri mbi lumin Vardar.
                Me një arkitekturë elegante dhe një atmosferë që ndërthur traditën me luksin modern,
                ky hotel ofron një përvojë të paharrueshme për vizitorët e tij.
            </p>
            <ul>
                <li><strong>Vendndodhje e Përsosur:</strong> I pozicionuar në qendër të qytetit, pranë monumenteve kryesore si Ura e Gurit dhe Kalaja e Shkupit, duke e bërë të lehtë eksplorimin e atraksioneve kulturore dhe historike të qytetit.</li>
                <li><strong>Akomodim Komod:</strong> Dhomat janë të dizajnuara me kujdes, duke ofruar një ambient të rehatshëm dhe të pastër për pushim pas një dite të ngarkuar.</li>
                <li><strong>Shërbime Shtesë:</strong> Hoteli ofron një gamë të gjerë shërbimesh për të përmbushur nevojat e mysafirëve, duke përfshirë një pishinë të brendshme dhe një qendër fitnesi.</li>
            </ul>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-12">
            <h4 class="reservation-title" style="color: #2980b9; font-weight: 600; margin-bottom: 1rem;">Rezervoni Periudhën dhe Dhomën</h4>
            <form id="reservationForm" class="d-flex flex-wrap align-items-center gap-3 reservation-form" novalidate>
                <input type="hidden" id="hotelId" value="1" />

                <input type="text" id="reservationRange" class="form-control" placeholder="Zgjidhni intervalin e datave" required />

                <input type="number" id="adultsCount" class="form-control" placeholder="Adultë (1-30)" min="1" max="30" value="2" required />

                <input type="number" id="childrenCount" class="form-control" placeholder="Fëmijë (0-17 vjeç)" min="0" max="10" value="0" />

                <input type="number" id="roomsCount" class="form-control" placeholder="Dhomat (1-10)" min="1" max="10" value="1" required />

                <button type="submit" class="btn btn-primary px-4">Rezervoni</button>
            </form>
            <div id="message" class="mt-3"></div>
        </div>
    </div>

    <style>
        .reservation-form {
            background: #f9faff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
            gap: 15px;
        }

            .reservation-form input.form-control {
                max-width: 180px;
                border: 1.5px solid #2980b9;
                transition: border-color 0.3s ease;
            }

                .reservation-form input.form-control:focus {
                    border-color: #1c5980;
                    box-shadow: 0 0 8px rgba(41, 128, 185, 0.4);
                    outline: none;
                }

            .reservation-form button {
                background: #2980b9;
                border: none;
                font-weight: 600;
                transition: background-color 0.3s ease;
            }

                .reservation-form button:hover {
                    background-color: #1c5980;
                }

        .reservation-title {
            text-align: left;
        }
    </style>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            flatpickr("#reservationRange", {
                mode: "range",
                dateFormat: "Y-m-d",
                minDate: "today",
            });

            const pricePerAdultPerNight = 40;
            const pricePerChildPerNight = 10;
            const pricePerRoomPerNight = 40;
            const messageDiv = document.getElementById("message");

            function calculatePrice() {
                const adultsCount = parseInt(document.getElementById("adultsCount").value, 10) || 0;
                const childrenCount = parseInt(document.getElementById("childrenCount").value, 10) || 0;
                const roomsCount = parseInt(document.getElementById("roomsCount").value, 10) || 1;
                const reservationRange = document.getElementById("reservationRange").value;

                let nightsCount = 1;
                if (reservationRange) {
                    const dates = reservationRange.split(" to ");
                    if (dates.length === 2) {
                        const start = new Date(dates[0]);
                        const end = new Date(dates[1]);
                        if (end > start) {
                            nightsCount = Math.max((end - start) / (1000 * 60 * 60 * 24), 1);
                        } else {
                            messageDiv.innerHTML = "<div class='alert alert-danger'>Data e përfundimit duhet të jetë pas datës së fillimit.</div>";
                            return;
                        }
                    } else {
                        messageDiv.innerHTML = "";
                        return;
                    }
                } else {
                    messageDiv.innerHTML = "";
                    return;
                }

                const totalPrice =
                    nightsCount *
                    (adultsCount * pricePerAdultPerNight +
                        childrenCount * pricePerChildPerNight +
                        roomsCount * pricePerRoomPerNight);

                messageDiv.innerHTML = "<div class='alert alert-info'>Çmimi total: $" + totalPrice.toFixed(2) + "</div>";
            }

            document.getElementById("adultsCount").addEventListener("input", calculatePrice);
            document.getElementById("childrenCount").addEventListener("input", calculatePrice);
            document.getElementById("roomsCount").addEventListener("input", calculatePrice);
            document.getElementById("reservationRange").addEventListener("change", calculatePrice);

            document.getElementById("reservationForm").addEventListener("submit", function (event) {
                event.preventDefault();

                const hotelId = document.getElementById("hotelId").value;
                const reservationRange = document.getElementById("reservationRange").value;
                const adultsCount = parseInt(document.getElementById("adultsCount").value, 10);
                const childrenCount = parseInt(document.getElementById("childrenCount").value, 10);
                const roomsCount = parseInt(document.getElementById("roomsCount").value, 10);

                if (!reservationRange || !adultsCount || !roomsCount) {
                    messageDiv.innerHTML = '<div class="alert alert-danger">Ju lutem plotësoni të gjitha fushat e detyrueshme.</div>';
                    return;
                }

                fetch('/Reservation/CheckAvailability', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ hotelId: parseInt(hotelId), reservationRange, adultsCount, childrenCount, roomsCount })
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Gabim gjatë kontrollit të disponueshmërisë: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.available) {
                            return fetch('/Reservation/MakeReservation', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ hotelId, reservationRange, adultsCount, childrenCount, roomsCount })
                            });
                        } else {
                            throw new Error('Nuk ka dhoma të lira për këtë periudhë.');
                        }
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Gabim gjatë procesit të rezervimit: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(reservationData => {
                        if (reservationData.success) {
                            messageDiv.innerHTML = '<div class="alert alert-success">Rezervimi u krye me sukses. Për detaje, kontrolloni email-in tuaj!</div>';
                        } else {
                            throw new Error(reservationData.message || 'Rezervimi dështoi. Provoni përsëri.');
                        }
                    })
                    .catch(error => {
                        messageDiv.innerHTML = `<div class="alert alert-danger">${error.message || 'Ndodhi një gabim. Ju lutem provoni përsëri më vonë.'}</div>`;
                    });
            });
        });
    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
