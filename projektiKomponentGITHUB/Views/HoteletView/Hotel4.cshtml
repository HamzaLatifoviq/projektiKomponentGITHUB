
@{
    ViewBag.Title = "Hotel4";
}

<h2>Tino Hotel & SPA</h2>
<div class="container mt-4">
    <h2 class="text-center">Rezervoni Hotelin</h2>
    <div class="row">
        <!-- Carousel për fotografitë -->
        <div class="col-md-8">
            <div id="hotelCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="/Content/BesnikFotoHotel/tinohotelspa1.jpg" class="d-block w-100" alt="Pamje nga Tino Hotel Spa">
                    </div>
                    <div class="carousel-item">
                        <img src="/Content/BesnikFotoHotel/tinohotelspa2.jpg" class="d-block w-100" alt="Pamje e dhomës në Tino Hotel Spa">
                    </div>
                    <div class="carousel-item">
                        <img src="/Content/BesnikFotoHotel/tinohotelspa3.jpg" class="d-block w-100" alt="Pamje e restorantit në Tino Hotel Spa">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#hotelCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#hotelCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <!-- Përshkrimi i Hotelit -->
        <div class="col-md-4">
            <h5>Përshkrimi i Hotelit</h5>
            <p>
                Tino Hotel & SPA është një hotel me 4 yje i vendosur në qendër të Ohrit,
                përgjatë bregut të Liqenit të Ohrit,
                duke ofruar një përvojë të shkëlqyer për vizitorët që kërkojnë rehati dhe shërbim cilësor.
            </p>
            <ul>
                Karakteristikat kryesore:

               <li> Vendndodhje ideale: I pozicionuar në Kej Makedonija Nr. 55, hoteli ndodhet vetëm 700 metra larg Qytetit të Vjetër dhe portit të Ohrit, duke ofruar qasje të lehtë në atraksionet kryesore të qytetit .</li>
              

             <li>   Akomodim komod: Hoteli ofron 50 dhoma të ajrosura dhe të mobiluara me shije, përfshirë apartamente dhe dhoma me pamje nga liqeni. Të gjitha dhomat janë të pajisura me ajër të kondicionuar, minibar dhe TV me ekran të sheshtë .</li>
                

            <li>    Shërbime shtesë: Përfshihet një qendër spa me përdorim falas, e cila përfshin jacuzzi, sauna dhe banjë termale. Gjithashtu, hoteli ofron shërbime si qira biçikletash dhe varkash, si dhe mundësi për t'u organizuar transport me makinë ose shërbim transporti nga/tek aeroporti .</li>

        <li>        Restorant dhe bar: Restoranti i hotelit shërben kuzhinë autentike italiane dhe ndërkombëtare, ndërsa një bar në vend ofron pije të ndryshme për mysafirët .</li>
              

         <li>       Vlerësimi i mysafirëve: Me një vlerësim prej 7.9 nga 10 në Booking.com, mysafirët vlerësojnë lart vendndodhjen, pastërtinë dhe shërbimin e stafit .</li>
            </ul>

            <p>
                Stafi i përkushtuar është gjithmonë i gatshëm për t’ju ofruar një qëndrim të paharrueshëm.
                Vila Arta është zgjedhja perfekte për çdo rast.
            </p>
        </div>
    </div>

    <div class="container mt-4">
        <h3 class="text-center mt-5">Rezervoni Periudhën dhe Dhomën</h3>
        <form id="reservationForm" class="mt-3">
            <input type="hidden" id="hotelId" value="2" />

            <!-- Data e rezervimit me ikonë kalendari -->
            <div class="form-group position-relative" style="max-width:320px; margin-bottom:1rem;">
                <label for="reservationRange">Zgjidhni Periudhën:</label>
                <input type="text" id="reservationRange" class="form-control" placeholder="Zgjidhni intervalin e datave" required style="padding-left:2.5rem;" />
                <span class="input-icon" style="position:absolute; left:12px; top:60%; transform: translateY(-50%); font-size:18px; color:#555; pointer-events:none;">📅</span>
            </div>

            <!-- Numri i adultëve me ikonë personi -->
            <div class="form-group position-relative" style="max-width:320px; margin-bottom:1rem;">
                <label for="adultsCount">Adultë:</label>
                <input type="number" id="adultsCount" class="form-control" min="1" max="30" value="2" required style="padding-left:2.5rem;" />
                <span class="input-icon" style="position:absolute; left:12px; top:60%; transform: translateY(-50%); font-size:18px; color:#555; pointer-events:none;">👤</span>
            </div>

            <!-- Numri i fëmijëve me ikonë personi -->
            <div class="form-group position-relative" style="max-width:320px; margin-bottom:1rem;">
                <label for="childrenCount">Fëmijë (0-17 vjeç):</label>
                <input type="number" id="childrenCount" class="form-control" min="0" max="10" value="0" style="padding-left:2.5rem;" />
                <span class="input-icon" style="position:absolute; left:12px; top:60%; transform: translateY(-50%); font-size:18px; color:#555; pointer-events:none;">👤</span>
            </div>

            <!-- Numri i dhomave me ikonë shtepie/dhoma -->
            <div class="form-group position-relative" style="max-width:320px; margin-bottom:1rem;">
                <label for="roomsCount">Dhomat:</label>
                <input type="number" id="roomsCount" class="form-control" min="1" max="10" value="1" required style="padding-left:2.5rem;" />
                <span class="input-icon" style="position:absolute; left:12px; top:60%; transform: translateY(-50%); font-size:18px; color:#555; pointer-events:none;">🏠</span>
            </div>

            <button type="submit" class="btn btn-primary mt-3">Rezervoni</button>
        </form>

        <div id="message" class="mt-3"></div>
    </div>
</div>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Inicializimi i Flatpickr për zgjedhjen e intervalit të datave
        flatpickr("#reservationRange", {
            mode: "range", // Lejon zgjedhjen e intervalit të datave
            dateFormat: "Y-m-d", // Formati i datës
            minDate: "today", // Data minimale është data e sotme
        });

        // Konstanta e çmimeve
        const pricePerAdultPerNight = 25;
        const pricePerChildPerNight = 15; // Example price for a child
        const pricePerRoomPerNight = 100; // Additional cost per room
        const messageDiv = document.getElementById("message");

        // Funksioni për llogaritjen e çmimit total
        function calculatePrice() {
            const adultsCount = parseInt(document.getElementById("adultsCount").value, 10) || 0;
            const childrenCount = parseInt(document.getElementById("childrenCount").value, 10) || 0;
            const roomsCount = parseInt(document.getElementById("roomsCount").value, 10) || 1;
            const reservationRange = document.getElementById("reservationRange").value;

            // Kalkulimi i numrit të netëve
            let nightsCount = 1;
            if (reservationRange) {
                const [startDate, endDate] = reservationRange.split(" to ");
                const start = new Date(startDate);
                const end = new Date(endDate);
                nightsCount = Math.max((end - start) / (1000 * 60 * 60 * 24), 1);
            }

            // Llogaritja e çmimit total
            const totalPrice =
                nightsCount *
                (adultsCount * pricePerAdultPerNight +
                    childrenCount * pricePerChildPerNight +
                    roomsCount * pricePerRoomPerNight);

            messageDiv.innerHTML = "<div class='alert alert-info'>Çmimi total: $" + totalPrice.toFixed(2) + "</div>";
        }

        // Lidh eventet input dhe change për të kalkuluar çmimin
        document.getElementById("adultsCount").addEventListener("input", calculatePrice);
        document.getElementById("childrenCount").addEventListener("input", calculatePrice);
        document.getElementById("roomsCount").addEventListener("input", calculatePrice);
        document.getElementById("reservationRange").addEventListener("change", calculatePrice);

        // Submit i formës për rezervim
        document.getElementById("reservationForm").addEventListener("submit", function (event) {
            event.preventDefault();

            const hotelId = document.getElementById("hotelId").value;
            const reservationRange = document.getElementById("reservationRange").value;
            const adultsCount = parseInt(document.getElementById("adultsCount").value, 10);
            const childrenCount = parseInt(document.getElementById("childrenCount").value, 10);
            const roomsCount = parseInt(document.getElementById("roomsCount").value, 10);

            if (!reservationRange || !adultsCount || !roomsCount) {
                messageDiv.innerHTML = '<div class="alert alert-danger">Ju lutem plotësoni të gjitha fushat e detyrueshme.</div>';
                return;
            }

            fetch('/Reservation/CheckAvailability', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ hotelId, reservationRange, adultsCount, childrenCount, roomsCount })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Gabim gjatë kontrollit të disponueshmërisë: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.available) {
                        return fetch('/Reservation/MakeReservation', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ hotelId, reservationRange, adultsCount, childrenCount, roomsCount })
                        });
                    } else {
                        throw new Error('Nuk ka dhoma të lira për këtë periudhë.');
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Gabim gjatë procesit të rezervimit: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(reservationData => {
                    if (reservationData.success) {
                        messageDiv.innerHTML = '<div class="alert alert-success">Rezervimi u krye me sukses. Për detaje, kontrolloni email-in tuaj!</div>';
                    } else {
                        throw new Error(reservationData.message || 'Rezervimi dështoi. Provoni përsëri.');
                    }
                })
                .catch(error => {
                    console.error("Gabim:", error.message);
                    messageDiv.innerHTML = `<div class="alert alert-danger">${error.message || 'Ndodhi një gabim. Ju lutem provoni përsëri më vonë.'}</div>`;
                });
        });
    });
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
</div>
